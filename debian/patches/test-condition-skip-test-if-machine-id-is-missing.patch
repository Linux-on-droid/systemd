From: Luca Boccassi <bluca@debian.org>
Date: Tue, 25 Oct 2022 00:56:44 +0100
Subject: test-condition: skip test if machine-id is missing

When building in a chroot there might not be any machine-id
---
 src/test/test-condition.c | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/src/test/test-condition.c b/src/test/test-condition.c
index 8fcaacc..4cd23d8 100644
--- a/src/test/test-condition.c
+++ b/src/test/test-condition.c
@@ -247,8 +247,12 @@ TEST(condition_test_host) {
         _cleanup_free_ char *hostname = NULL;
         Condition *condition;
         sd_id128_t id;
+        int r;
 
-        assert_se(sd_id128_get_machine(&id) >= 0);
+        r = sd_id128_get_machine(&id);
+        if (IN_SET(r, -ENOENT, -ENOMEDIUM))
+                return (void) log_tests_skipped("/etc/machine-id missing");
+        assert_se(r >= 0);
 
         condition = condition_new(CONDITION_HOST, SD_ID128_TO_STRING(id), false, false);
         assert_se(condition);
