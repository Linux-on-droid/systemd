From: Chris Coulson <chris.coulson@canonical.com>
Date: Thu, 4 Apr 2019 12:23:10 +0200
Subject: pam-systemd: use secure_getenv() rather than getenv()

Backport of upstream commit 83d4ab55336ff8a0643c6aa627b31e351a24040a.

CVE-2019-3842
---
 src/login/pam_systemd.c | 10 +++++-----
 1 file changed, 5 insertions(+), 5 deletions(-)

diff --git a/src/login/pam_systemd.c b/src/login/pam_systemd.c
index b62b8d2..5114736 100644
--- a/src/login/pam_systemd.c
+++ b/src/login/pam_systemd.c
@@ -283,27 +283,27 @@ _public_ PAM_EXTERN int pam_sm_open_session(
 
         seat = pam_getenv(handle, "XDG_SEAT");
         if (isempty(seat))
-                seat = getenv("XDG_SEAT");
+                seat = secure_getenv("XDG_SEAT");
 
         cvtnr = pam_getenv(handle, "XDG_VTNR");
         if (isempty(cvtnr))
-                cvtnr = getenv("XDG_VTNR");
+                cvtnr = secure_getenv("XDG_VTNR");
 
         type = pam_getenv(handle, "XDG_SESSION_TYPE");
         if (isempty(type))
-                type = getenv("XDG_SESSION_TYPE");
+                type = secure_getenv("XDG_SESSION_TYPE");
         if (isempty(type))
                 type = type_pam;
 
         class = pam_getenv(handle, "XDG_SESSION_CLASS");
         if (isempty(class))
-                class = getenv("XDG_SESSION_CLASS");
+                class = secure_getenv("XDG_SESSION_CLASS");
         if (isempty(class))
                 class = class_pam;
 
         desktop = pam_getenv(handle, "XDG_SESSION_DESKTOP");
         if (isempty(desktop))
-                desktop = getenv("XDG_SESSION_DESKTOP");
+                desktop = secure_getenv("XDG_SESSION_DESKTOP");
 
         tty = strempty(tty);
 
